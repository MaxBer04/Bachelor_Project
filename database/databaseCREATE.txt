CREATE TABLE User(
	ID INTEGER NOT NULL,
	email VARCHAR NOT NULL UNIQUE,
	passwordHash VARCHAR NOT NULL,
	verified BOOLEAN,
	first_name VARCHAR NOT NULL CHECK(first_name <> '' AND first_name NOT GLOB '*[^a-zA-Z]*'),
	last_name VARCHAR NOT NULL CHECK(last_name <> '' AND last_name NOT GLOB '*[^a-zA-Z]*'),
	PRIMARY key(ID)
);

CREATE TABLE Admin(
	userID INTEGER NOT NULL,
	FOREIGN key(userID) REFERENCES User(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(userID)
);

CREATE TABLE ImageSet(
	ID INTEGER NOT NULL,
	title VARCHAR NOT NULL,
	upload_date DATE NOT NULL,
	PRIMARY key(ID)
);

CREATE TABLE Image(
	ID INTEGER NOT NULL,
	imageSetID INTEGER NOT NULL,
	path VARCHAR NOT NULL,
	type VARCHAR NOT NULL,
	FOREIGN key(imageSetID) REFERENCES ImageSet(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(ID)
);

CREATE TABLE Annotation(
	ID INTEGER NOT NULL,
	imageID INTEGER NOT NULL,
	userID INTEGER NOT NULL,
	shape VARCHAR,
	text VARCHAR,
	color VARCHAR NOT NULL,
	name VARCHAR,
	FOREIGN key(imageID) REFERENCES Image(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN key(userID) REFERENCES User(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(ID)
);

CREATE TABLE Attribut(
	ID INTEGER NOT NULL,
	annotationID INTEGER NOT NULL,
	text VARCHAR NOT NULL,
	FOREIGN key(annotationID) REFERENCES Annotation(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(ID)
);
CREATE TABLE Point(
	ID INTEGER NOT NULL,
	X INTEGER NOT NULL,
	Y INTEGER NOT NULL,
	annotationID Integer NOT NULL,
	FOREIGN key(annotationID) REFERENCES Annotation(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(ID)
);

CREATE TABLE Image_annotated_by_User(
	imageID INTEGER NOT NULL,
	userID INTEGER NOT NULL,
	timestamp DATE NOT NULL,
	FOREIGN key(imageID) REFERENCES Image(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN key(userID) REFERENCES User(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(userID, imageID)
);

CREATE TABLE ImageSet_annotated_by_User(
	imageSetID Integer NOT NULL,
	userID Integer NOT NULL,
	timestamp DATE NOT NULL,
	FOREIGN key(imageSetID) REFERENCES ImageSet(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN key(userID) REFERENCES User(ID) ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY key(imageSetID, userID)
);
